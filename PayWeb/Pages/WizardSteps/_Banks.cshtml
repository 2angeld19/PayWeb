@model WizardModel

<div class="container-fluid">
    <div class="mb-4">
        <h4>Configuración Bancaria</h4>
        <p class="text-muted">Configure la información bancaria y métodos de pago</p>
    </div>

    <form id="bankForm" class="bg-light p-3 rounded">
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="bankNumber" class="form-label">Nº Banco:</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="bankNumber" name="BankNumber" value="0">
                </div>
            </div>
            <div class="col-md-9">
                <label for="bankName" class="form-label">&nbsp;</label>
                <input type="text" class="form-control" id="bankName" name="BankName">
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-5">
                <label for="assignedNumber" class="form-label">Número Asignado por el Banco:</label>
                <input type="text" class="form-control" id="assignedNumber" name="AssignedNumber">
            </div>
            <div class="col-md-7">
                <label for="interfaceCode" class="form-label">Cod. Interfase:</label>
                <input type="text" class="form-control" id="interfaceCode" name="InterfaceCode">
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <h6>Información sobre la Cuenta</h6>

                <div class="mb-3">
                    <label for="lastCheckUsed" class="form-label">Último cheque usado:</label>
                    <input type="number" class="form-control" id="lastCheckUsed" name="LastCheckUsed" value="0">
                </div>

                <div class="mb-3">
                    <label for="bankAccountNumber" class="form-label">No. de Cta. Bancaria:</label>
                    <input type="text" class="form-control" id="bankAccountNumber" name="BankAccountNumber">
                </div>

                <div class="mb-3">
                    <label class="form-label d-block">Tipo de Cuenta:</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="AccountType" id="accountTypeCurrent" value="current">
                        <label class="form-check-label" for="accountTypeCurrent">Corriente</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="AccountType" id="accountTypeSavings" value="savings">
                        <label class="form-check-label" for="accountTypeSavings">Ahorro</label>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="bankRoute" class="form-label">Ruta/Tránsito del Banco:</label>
                    <div class="input-group mb-2">
                        <select class="form-select" id="bankRoute" name="BankRoute">
                            <option value="" selected>[Sin Definir]</option>
                            <option value="route1">Ruta 1</option>
                            <option value="route2">Ruta 2</option>
                        </select>
                    </div>
                    <input type="text" class="form-control" id="routeNumber" name="RouteNumber">
                </div>

                <div class="mb-3">
                    <label for="achFormat" class="form-label">El formato de ACH:</label>
                    <select class="form-select" id="achFormat" name="AchFormat">
                        <option value="" selected>[Sin Definir]</option>
                        <option value="format1">Formato 1</option>
                        <option value="format2">Formato 2</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="generalLedgerAccount" class="form-label">Cuenta del Mayor:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="generalLedgerAccount" name="GeneralLedgerAccount">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="controlAchSequence" name="ControlAchSequence">
                        <label class="form-check-label" for="controlAchSequence">
                            Controlar Secuencia de Ach
                        </label>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="mb-4">
                    <h6>La carta debe estar dirigida a:</h6>
                    <textarea class="form-control" id="letterAddress" name="LetterAddress" rows="5"></textarea>
                </div>

                <div class="mb-4">
                    <h6>y Firmada por:</h6>
                    <input type="text" class="form-control" id="signature" name="Signature">
                </div>

                <div class="mb-4">
                    <h6>Nuestro Contacto es:</h6>
                    <input type="text" class="form-control" id="ourContact" name="OurContact">
                </div>

                <div class="mb-4">
                    <h6>Copiar Configuración de Cheques de:</h6>
                    <select class="form-select" id="copyCheckConfig" name="CopyCheckConfig">
                        <option value="" selected></option>
                        <option value="bank1">Banco 1</option>
                        <option value="bank2">Banco 2</option>
                    </select>
                </div>

                <div class="row mb-2">
                    <div class="col-md-6">
                        <label for="employeeAchSequence" class="form-label">Secuencia ACH Empleados:</label>
                    </div>
                    <div class="col-md-6">
                        <input type="number" class="form-control" id="employeeAchSequence" name="EmployeeAchSequence" value="0">
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <label for="supplierAchSequence" class="form-label">Secuencia ACH Acreedores:</label>
                    </div>
                    <div class="col-md-6">
                        <input type="number" class="form-control" id="supplierAchSequence" name="SupplierAchSequence" value="0">
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('bankForm');

        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(form);

                fetch('/Form/SaveBanks', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Éxito', 'La información del banco se ha guardado correctamente', 'success');
                    } else {
                        showToast('Error', 'Hubo un problema al guardar la información', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Error', 'Hubo un problema al procesar la solicitud', 'error');
                });
            });
        }

        // Si el formulario está dentro de un modal...
        const saveButton = document.getElementById('sharedModalSaveButton');
        if (saveButton && form) {
            saveButton.addEventListener('click', function() {
                const event = new Event('submit', {
                    'bubbles': true,
                    'cancelable': true
                });
                form.dispatchEvent(event);
            });
        }
    });
</script>